# ProLIF MDAnalysis除去タスクリスト

## フェーズ1: 基本的な置き換え（1週間）

### Task 1.1: VdW半径データの独自実装
- [ ] `prolif/interactions/constants.py`の修正
  - [ ] 文献ベースのVDW_RADIIディクショナリを作成
  - [ ] 既存のvdwradiiインポートを置き換え
  - [ ] 後方互換性のためのエイリアスを設定
- [ ] テストの作成・更新
  - [ ] VdW半径の値が正しいことを確認
  - [ ] 既存のinteractionsテストがパスすることを確認

### Task 1.2: MDAnalysisインポートの条件分岐
- [ ] `prolif/interactions/water_bridge.py`の修正
  - [ ] MDAnalysisのインポートをtry/except文で囲む
  - [ ] `_HAS_MDANALYSIS`フラグを設定
  - [ ] UpdatingAtomGroupのダミークラスを作成
- [ ] `prolif/utils.py`の修正
  - [ ] MDAnalysisインポートの条件分岐追加
  - [ ] 必要に応じて他のファイルも同様に対応

### Task 1.3: pyproject.tomlの依存関係除去
- [ ] MDAnalysis依存関係をコメントアウト
- [ ] テスト環境での動作確認
- [ ] CIでのテスト実行確認

## フェーズ2: 関数レベルの対応（1週間）

### Task 2.1: Molecule.from_mda()のエラー実装
- [ ] `prolif/molecule.py`の修正
  - [ ] `from_mda()`メソッドをNotImplementedErrorに変更
  - [ ] 適切なエラーメッセージを設定
  - [ ] 代替手法の案内を含める
- [ ] テストの更新
  - [ ] エラーが正しく発生することを確認
  - [ ] エラーメッセージの内容を確認

### Task 2.2: Fingerprint.run()のトラジェクトリ判定
- [ ] `prolif/fingerprint.py`の修正
  - [ ] `run()`メソッドにトラジェクトリ判定ロジック追加
  - [ ] 単一構造解析は維持
  - [ ] トラジェクトリの場合はNotImplementedError
- [ ] テストの更新
  - [ ] 単一構造解析が正常動作することを確認
  - [ ] トラジェクトリ渡し時にエラーが発生することを確認

### Task 2.3: select_over_trajectory()のエラー実装
- [ ] `prolif/utils.py`の修正
  - [ ] `select_over_trajectory()`をNotImplementedErrorに変更
  - [ ] 適切なエラーメッセージを設定
- [ ] テストの更新
  - [ ] エラーが正しく発生することを確認

### Task 2.4: 水分子ブリッジの簡略化
- [ ] `prolif/interactions/water_bridge.py`の修正
  - [ ] WaterBridgeクラスの初期化でMDAnalysis依存チェック
  - [ ] 静的解析のみをサポート
  - [ ] UpdatingAtomGroup使用時にエラーを発生
- [ ] テストの更新
  - [ ] 静的解析が正常動作することを確認
  - [ ] 動的解析時にエラーが発生することを確認

## フェーズ3: テストと検証（1週間）

### Task 3.1: 既存テストの修正
- [ ] MDAnalysisを使用するテストの特定
  - [ ] `tests/test_fingerprint.py`
  - [ ] `tests/test_molecule.py`
  - [ ] `tests/test_utils.py`
  - [ ] その他関連テスト
- [ ] テストの修正・無効化
  - [ ] MDAnalysis依存テストをスキップまたは削除
  - [ ] pytest.skipやmarkを使用
  - [ ] 代替テストの追加（可能な場合）

### Task 3.2: エラーメッセージのテスト
- [ ] 新しいテストの作成
  - [ ] `from_mda()`のエラーテスト
  - [ ] `run()`のトラジェクトリエラーテスト
  - [ ] `select_over_trajectory()`のエラーテスト
  - [ ] 水分子ブリッジのエラーテスト
- [ ] エラーメッセージの内容確認
  - [ ] 適切な説明が含まれているか
  - [ ] 代替手法の案内があるか

### Task 3.3: ドッキング解析での動作確認
- [ ] 実際のドッキング結果での動作テスト
  - [ ] PDB + SDFファイルでの解析
  - [ ] PDBQT + SDFファイルでの解析
  - [ ] 複数リガンドでの一括解析
- [ ] パフォーマンステスト
  - [ ] 処理速度の確認
  - [ ] メモリ使用量の確認
- [ ] 結果の整合性確認
  - [ ] 既存実装との結果比較（可能な範囲で）

### Task 3.4: ドキュメント更新
- [ ] README.mdの更新
  - [ ] インストール手順の修正
  - [ ] 使用例の更新
  - [ ] 制限事項の明記
- [ ] API ドキュメントの更新
  - [ ] 廃止予定APIの明記
  - [ ] 新しい推奨使用法の追加
- [ ] 移行ガイドの作成
  - [ ] 既存ユーザー向けの移行手順
  - [ ] コード例の提供

## 追加タスク（必要に応じて）

### Task A.1: CI/CDの更新
- [ ] GitHub Actionsの修正
  - [ ] MDAnalysisのインストール除去
  - [ ] テスト設定の更新
- [ ] 依存関係チェックの追加
  - [ ] MDAnalysisが意図せずインストールされていないか確認

### Task A.2: サンプルコードの更新
- [ ] `docs/`配下のサンプル更新
- [ ] Jupyter notebookの更新
- [ ] チュートリアルの修正

### Task A.3: リリース準備
- [ ] CHANGELOGの更新
- [ ] バージョン番号の更新（メジャーバージョンアップ）
- [ ] リリースノートの作成

## 進捗チェックリスト

### 完了基準
- [ ] 全テストがパス（MDAnalysis依存以外）
- [ ] MDAnalysisなしでパッケージがインストール可能
- [ ] ドッキング解析の基本機能が動作
- [ ] 適切なエラーメッセージが表示される
- [ ] ドキュメントが更新されている

### 品質チェック
- [ ] コードカバレッジの確認
- [ ] 静的解析（ruff、mypyなど）のパス
- [ ] パフォーマンステストの通過
- [ ] メモリリークの確認

### 最終確認
- [ ] 実際のユーザーによる動作確認
- [ ] 既存プロジェクトでの互換性確認
- [ ] エラーメッセージの分かりやすさ確認